<?php 
    $parse_url = parse_url("//" . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI']);
    $parse_query = parse_str($parse_url['query'], $query);
    $url_arr = explode('/', $parse_url['path']);
    $nav = $url_arr[3];
    $page = $url_arr[4];
    $menu = $url_arr[5];
    $tab = $query['tab'] - 1;
    $isMobile = $_GET['set_view'] == 'mobile' || is_mobile_check();
    $device = $isMobile ? 'm' : 'pc';
?>

<link rel="stylesheet" href="/css/guide/<?=$device?>/layouts.css?v=<?=time()?>">
<!-- <link rel="stylesheet" href="/css/components/<?=$device?>/components.css?v=<?=time()?>"> -->
<script src="/js/components/<?=$device?>/components.js?v=<?=time()?>"></script>

<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>

<header>
    <div class="inner">
        <div class="header_wrap">
            <?php if($isMobile){ ?>
            <!-- <a href="javascript:;" class="ico ico_menu menu"></a> -->
            <?php } ?>
            <h1><a href="/pub/guide/index<?=$isMobile ? '?set_view=mobile' : '' ?>">DANGI PUB GUIDE</a></h1>
        </div>
    </div>
</header>

<script>
    let content_nav;
    $(function(){
        // ê³µí†µ íƒ­
        let tab = <?=$tab?>;
        content_nav = $('.content_nav').cnTab({
            onClick: function(_, index){
                window.history.replaceState('', '', index == 0  ? `<?=$parse_url["path"]?>` : `<?=$parse_url["path"]?>?tab=${(index+1)}`);
                // window.history.replaceState('page2', 'Title', '/page2.php');
            },
            startIndex: tab ? tab : 0,
        });

        // ë©”ë‰´ í† ê¸€
        $('.side_menu .menu strong').click(function(){
            $(this).parent().toggleClass('active');
        })

        // ì½”ë“œ
        document.querySelectorAll('pre code').forEach((element) => {
            let decodedText = element.innerHTML.replace(/&amp;/g, "&").replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&quot;/g, '"').replace(/&#039;/g, "'");
            element.textContent = decodedText;
            hljs.highlightElement(element);
            setTimeout(() => {
                $(element).css('display', 'block')
            }, 300);
        });

        // ì½”ë“œ í† ê¸€ ë²„íŠ¼ ìƒì„±
        $('.content_wrap .code_wrap').each(function(){
            $(this).prepend('<ul class="code_nav"><li><i class="ico ico_eye_line"></i><span>Preview</span></li><li><i class="ico ico_monitor"></i><span>Code</span></li></ul>')
        })

        $('.code_nav').cnTab();

        // ëª¨ë°”ì¼ LNB í† ê¸€
        $('.header_wrap .menu').click(function(){
            $('.side_menu').toggleClass('active');
        })
    });

    $(document).ready(function () {
        $("pre code").each(function () {
            // í˜„ì¬ ì½”ë“œ ë¸”ë¡ì´ í¬í•¨ëœ <pre> ìš”ì†Œ ì°¾ê¸°
            let preBlock = $(this).closest("pre");

            // ë³µì‚¬ ë²„íŠ¼ ì¶”ê°€ (ì´ë¯¸ ì¶”ê°€ëœ ê²½ìš° ì¤‘ë³µ ë°©ì§€)
            if (preBlock.find(".copy_button").length === 0) {
                preBlock.append('<button class="copy_button">ğŸ“‹ ë³µì‚¬</button>');
            }
        });

        // ë³µì‚¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        $(".copy_button").click(function () {
            let codeBlock = $(this).siblings("code"); // ê°™ì€ <pre> ì•ˆì˜ <code> ìš”ì†Œ ì°¾ê¸°
            let textToCopy = codeBlock.text().trim(); // ì½”ë“œ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°

            // í´ë¦½ë³´ë“œì— ë³µì‚¬
            navigator.clipboard.writeText(textToCopy).then(() => {
                $(this).text("âœ” ë³µì‚¬ë¨!"); // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
                setTimeout(() => {
                    $(this).text("ğŸ“‹ ë³µì‚¬"); // ì›ë˜ ìƒíƒœë¡œ ë³µê·€
                }, 1500);
            }).catch(err => {
                console.error("ë³µì‚¬ ì‹¤íŒ¨:", err);
            });
        });
    });

</script>

<nav>
    <div class="nav_menu">
        <div class="menu <?=$nav == 'landing' ? ' selected' : ''?>">
            <a href="/pub/guide/landing/home<?=$isMobile ? '?set_view=mobile' : '' ?>"><strong><span>Landing</span></strong></a>
        </div>
        <div class="menu <?=$nav == 'cnplugin' ? ' selected' : ''?>">
            <a href="/pub/guide/cnplugin/home<?=$isMobile ? '?set_view=mobile' : '' ?>"><strong><span>cnPlugin</span></strong></a>
        </div>
        <div class="menu <?=$nav == 'animation' ? ' selected' : ''?>">
            <a href="/pub/guide/animation/home<?=$isMobile ? '?set_view=mobile' : '' ?>"><strong><span>Animation</span></strong></a>
        </div>
        <div class="menu <?=$nav == 'premium' ? ' selected' : ''?>">
            <a href="/pub/guide/premium/home<?=$isMobile ? '?set_view=mobile' : '' ?>"><strong><span>Premium</span></strong></a>
        </div>
        <div class="menu <?=$nav == 'components' ? ' selected' : ''?>">
            <a href="/pub/guide/components/home<?=$isMobile ? '?set_view=mobile' : '' ?>"><strong><span>Dangi Components</span></strong></a>
        </div>
        <div class="menu <?=$nav == 'gongsoop' ? ' selected' : ''?>">
            <a href="/pub/guide/gongsoop/home<?=$isMobile ? '?set_view=mobile' : '' ?>"><strong><span>Gongsoop</span></strong></a>
        </div>
    </div>
</nav>
<main>